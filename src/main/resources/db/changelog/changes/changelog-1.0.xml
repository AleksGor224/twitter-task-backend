<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.0.xsd
      http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet id="1" author="bob">
        <ext:createCollection collectionName="users">
            <ext:options>
                {
                validator: {
                $jsonSchema: {
                bsonType: "object",
                required: ["userId", "username", "password", "registrationDate", "lastUpdate"],
                properties: {
                userId: {
                bsonType: "string",
                description: "User ID"
                },
                username: {
                bsonType: "string",
                description: "Username"
                },
                password: {
                bsonType: "string",
                description: "Encrypted password"
                }
                registrationDate: {
                bsonType: "long",
                description: "Reg date in epoch format"
                },
                lastUpdate: {
                bsonType: "long",
                description: "Last update in epoch format"
                },
                followers: {
                bsonType: "array",
                description: "Array of user's followers"
                }
                subscribers: {
                bsonType: "array",
                description: "Array of user's subscribers"
                }
                posts: {
                bsonType: "array",
                description: "Array of user's posts"
                }
                }
                }
                },
                validationAction: "warn",
                validationLevel: "strict"
                }
            </ext:options>
        </ext:createCollection>
        <ext:createCollection collectionName="posts">
            <ext:options>
                {
                validator: {
                $jsonSchema: {
                bsonType: "object",
                required: ["ownerId", "data"],
                properties: {
                ownerId: {
                bsonType: "string",
                description: "Owner ID"
                },
                data: {
                bsonType: "string",
                description: "Data in text format"
                },
                likedBy: {
                bsonType: "array",
                description: "Array of users that liked a current post"
                }
                comments: {
                bsonType: "array",
                description: "Array of related post's comments"
                }
                }
                }
                },
                validationAction: "warn",
                validationLevel: "strict"
                }
            </ext:options>
        </ext:createCollection>
        <ext:createCollection collectionName="comments">
            <ext:options>
                {
                validator: {
                $jsonSchema: {
                bsonType: "object",
                required: ["ownerId", "postId"],
                properties: {
                ownerId: {
                bsonType: "string",
                description: "Owner ID"
                },
                postId: {
                bsonType: "string",
                description: "Post ID"
                },
                likedBy: {
                bsonType: "array",
                description: "Array of users that liked a current post"
                }
                }
                }
                },
                validationAction: "warn",
                validationLevel: "strict"
                }
            </ext:options>
        </ext:createCollection>
    </changeSet>
</databaseChangeLog>